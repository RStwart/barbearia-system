<div class="agendar-container">
  <!-- Header -->
  <div class="header-agendamento">
    <button class="btn-voltar" (click)="voltar()">
      ‚Üê Voltar
    </button>
    
    <div class="info-servico" *ngIf="servico && barbearia">
      <h1>Agendar Servi√ßo</h1>
      <div class="servico-resumo">
        <h2>{{ servico.nome }}</h2>
        <p>{{ barbearia.nome }}</p>
        <div class="servico-detalhes">
          <span class="badge">‚è±Ô∏è {{ servico.duracao }} min</span>
          <span class="badge preco">{{ formatarPreco(servico.preco) }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Progresso -->
  <div class="progresso-etapas">
    <div class="etapa" [class.ativa]="etapaAtual >= 1" [class.concluida]="etapaAtual > 1">
      <div class="etapa-numero">1</div>
      <span>Profissional</span>
    </div>
    <div class="etapa-linha" [class.ativa]="etapaAtual > 1"></div>
    <div class="etapa" [class.ativa]="etapaAtual >= 2" [class.concluida]="etapaAtual > 2">
      <div class="etapa-numero">2</div>
      <span>Data e Hora</span>
    </div>
    <div class="etapa-linha" [class.ativa]="etapaAtual > 2"></div>
    <div class="etapa" [class.ativa]="etapaAtual >= 3">
      <div class="etapa-numero">3</div>
      <span>Pagamento</span>
    </div>
  </div>

  <!-- Mensagem de erro -->
  <div class="mensagem erro" *ngIf="erro">
    ‚ùå {{ erro }}
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="carregando">
    <div class="spinner"></div>
    <p>Carregando...</p>
  </div>

  <!-- Etapa 1: Selecionar Funcion√°rio -->
  <div class="etapa-conteudo" *ngIf="etapaAtual === 1 && !carregando">
    <h3>Escolha o Profissional</h3>
    
    <div class="funcionarios-grid">
      <div 
        class="funcionario-card" 
        *ngFor="let funcionario of funcionarios"
        [class.selecionado]="funcionarioSelecionado?.id === funcionario.id"
        (click)="selecionarFuncionario(funcionario)">
        <div class="funcionario-avatar">
          <img [src]="funcionario.foto_url || 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=300&q=80'" 
               [alt]="funcionario.nome">
        </div>
        <h4>{{ funcionario.nome }}</h4>
        <div class="check-icon" *ngIf="funcionarioSelecionado?.id === funcionario.id">‚úì</div>
      </div>
    </div>

    <div class="acoes">
      <button 
        class="btn btn-primary" 
        (click)="proximaEtapa()"
        [disabled]="!funcionarioSelecionado">
        Continuar ‚Üí
      </button>
    </div>
  </div>

  <!-- Etapa 2: Selecionar Data e Hora -->
  <div class="etapa-conteudo" *ngIf="etapaAtual === 2">
    <h3>Escolha a Data e Hor√°rio</h3>
    
    <div class="calendario-container">
      <div class="calendario-header">
        <button class="btn-mes" (click)="mesAnterior()">‚Üê</button>
        <h4>{{ getNomeMes() }}</h4>
        <button class="btn-mes" (click)="mesSeguinte()">‚Üí</button>
      </div>
      
      <div class="calendario">
        <div class="dia-semana">Dom</div>
        <div class="dia-semana">Seg</div>
        <div class="dia-semana">Ter</div>
        <div class="dia-semana">Qua</div>
        <div class="dia-semana">Qui</div>
        <div class="dia-semana">Sex</div>
        <div class="dia-semana">S√°b</div>
        
        <div 
          *ngFor="let dia of diasDoMes"
          class="dia"
          [class.vazio]="isDiaVazio(dia)"
          [class.passado]="isDiaPassado(dia)"
          [class.selecionado]="isDiaSelecionado(dia)"
          (click)="selecionarData(dia)">
          <span *ngIf="!isDiaVazio(dia)">{{ dia.getDate() }}</span>
        </div>
      </div>
    </div>

    <div class="horarios-container" *ngIf="dataSelecionada">
      <h4>Hor√°rios Dispon√≠veis - {{ formatarData(dataSelecionada) }}</h4>
      
      <div class="horarios-grid">
        <div 
          *ngFor="let horario of horariosDisponiveis"
          class="horario-slot"
          [class.indisponivel]="!horario.disponivel"
          [class.selecionado]="horarioSelecionado === horario.hora"
          (click)="selecionarHorario(horario)">
          {{ horario.hora }}
        </div>
      </div>
    </div>

    <div class="acoes">
      <button class="btn btn-secondary" (click)="etapaAnterior()">
        ‚Üê Voltar
      </button>
      <button 
        class="btn btn-primary" 
        (click)="proximaEtapa()"
        [disabled]="!dataSelecionada || !horarioSelecionado">
        Continuar ‚Üí
      </button>
    </div>
  </div>

  <!-- Etapa 3: Pagamento -->
  <div class="etapa-conteudo" *ngIf="etapaAtual === 3">
    <h3>Pagamento Antecipado</h3>
    
    <div class="resumo-agendamento">
      <h4>Resumo do Agendamento</h4>
      <div class="resumo-item">
        <span>Servi√ßo:</span>
        <strong>{{ servico?.nome }}</strong>
      </div>
      <div class="resumo-item">
        <span>Profissional:</span>
        <strong>{{ funcionarioSelecionado?.nome }}</strong>
      </div>
      <div class="resumo-item">
        <span>Data:</span>
        <strong>{{ formatarData(dataSelecionada!) }}</strong>
      </div>
      <div class="resumo-item">
        <span>Hor√°rio:</span>
        <strong>{{ horarioSelecionado }}</strong>
      </div>
      <div class="resumo-item total">
        <span>Total:</span>
        <strong>{{ formatarPreco(servico?.preco || 0) }}</strong>
      </div>
    </div>

    <div class="metodos-pagamento">
      <h4>Escolha a forma de pagamento</h4>
      
      <div class="pagamento-opcoes">
        <div 
          class="pagamento-card"
          [class.selecionado]="metodoPagamento === 'pix'"
          (click)="selecionarMetodoPagamento('pix')">
          <div class="icone-pagamento">üì±</div>
          <h5>PIX</h5>
          <p>Pagamento instant√¢neo</p>
          <div class="check-icon" *ngIf="metodoPagamento === 'pix'">‚úì</div>
        </div>
        
        <div 
          class="pagamento-card"
          [class.selecionado]="metodoPagamento === 'cartao'"
          (click)="selecionarMetodoPagamento('cartao')">
          <div class="icone-pagamento">üí≥</div>
          <h5>Cart√£o</h5>
          <p>Cr√©dito ou D√©bito</p>
          <div class="check-icon" *ngIf="metodoPagamento === 'cartao'">‚úì</div>
        </div>
      </div>
    </div>

    <div class="acoes">
      <button class="btn btn-secondary" (click)="etapaAnterior()" [disabled]="processandoPagamento">
        ‚Üê Voltar
      </button>
      <button 
        class="btn btn-success" 
        (click)="finalizarAgendamento()"
        [disabled]="!metodoPagamento || processandoPagamento">
        <span *ngIf="!processandoPagamento">üí∞ Confirmar e Pagar</span>
        <span *ngIf="processandoPagamento">Processando...</span>
      </button>
    </div>
  </div>

  <!-- Modal de Sucesso -->
  <div class="modal-sucesso" *ngIf="agendamentoConcluido">
    <div class="modal-conteudo">
      <div class="icone-sucesso">‚úÖ</div>
      <h2>Agendamento Confirmado!</h2>
      <p>Seu pagamento foi processado com sucesso.</p>
      <p>Voc√™ receber√° uma confirma√ß√£o por e-mail.</p>
      <div class="spinner-redirect"></div>
      <p class="texto-redirect">Redirecionando...</p>
    </div>
  </div>
</div>
