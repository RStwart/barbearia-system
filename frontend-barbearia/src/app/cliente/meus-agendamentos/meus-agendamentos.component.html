<div class="agendamentos-container">
  <!-- Header -->
  <div class="header-agendamentos">
    <div class="titulo-section">
      <h1>üìÖ Meus Agendamentos</h1>
      <p>Gerencie seus agendamentos e avalie os servi√ßos</p>
    </div>
    <button class="btn btn-primary" (click)="novoAgendamento()">
      ‚ûï Novo Agendamento
    </button>
  </div>

  <!-- Filtros -->
  <div class="filtros-container">
    <button 
      class="filtro-btn" 
      [class.ativo]="filtroStatus === 'todos'"
      (click)="alterarFiltro('todos')">
      Todos
    </button>
    <button 
      class="filtro-btn" 
      [class.ativo]="filtroStatus === 'pendente'"
      (click)="alterarFiltro('pendente')">
      Pendentes
    </button>
    <button 
      class="filtro-btn" 
      [class.ativo]="filtroStatus === 'confirmado'"
      (click)="alterarFiltro('confirmado')">
      Confirmados
    </button>
    <button 
      class="filtro-btn" 
      [class.ativo]="filtroStatus === 'concluido'"
      (click)="alterarFiltro('concluido')">
      Conclu√≠dos
    </button>
    <button 
      class="filtro-btn" 
      [class.ativo]="filtroStatus === 'cancelado'"
      (click)="alterarFiltro('cancelado')">
      Cancelados
    </button>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="carregando">
    <div class="spinner"></div>
    <p>Carregando agendamentos...</p>
  </div>

  <!-- Erro -->
  <div class="mensagem erro" *ngIf="erro">
    ‚ùå {{ erro }}
  </div>

  <!-- Tabela de Agendamentos -->
  <div class="tabela-container" *ngIf="!carregando && agendamentosFiltrados.length > 0">
    <table class="tabela-agendamentos">
      <thead>
        <tr>
          <th>Data</th>
          <th>Hor√°rio</th>
          <th>Servi√ßo</th>
          <th>Profissional</th>
          <th>Unidade</th>
          <th>Valor</th>
          <th>Status</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let agendamento of agendamentosFiltrados" class="linha-agendamento">
          <td>
            <div class="data-info">
              <span class="data-dia">{{ formatarData(agendamento.data_agendamento) }}</span>
            </div>
          </td>
          <td>
            <div class="horario-info">
              <span class="horario">{{ agendamento.hora_inicio.substring(0,5) }} - {{ agendamento.hora_fim.substring(0,5) }}</span>
            </div>
          </td>
          <td>
            <div class="servico-info">
              <strong>{{ agendamento.servico_nome }}</strong>
              <p *ngIf="agendamento.servico_descricao">{{ agendamento.servico_descricao }}</p>
            </div>
          </td>
          <td>
            <div class="funcionario-info">
              <div class="funcionario-avatar">
                <img [src]="agendamento.funcionario_foto || 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&q=80'" 
                     [alt]="agendamento.funcionario_nome">
              </div>
              <span>{{ agendamento.funcionario_nome }}</span>
            </div>
          </td>
          <td>
            <div class="unidade-info">
              <strong>{{ agendamento.unidade_nome }}</strong>
              <p *ngIf="agendamento.cidade">{{ agendamento.cidade }}</p>
            </div>
          </td>
          <td>
            <span class="valor">{{ formatarPreco(agendamento.valor_total) }}</span>
          </td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(agendamento.status)">
              {{ getStatusTexto(agendamento.status) }}
            </span>
          </td>
          <td>
            <div class="acoes-grupo">
              <button 
                *ngIf="podeAvaliar(agendamento)"
                class="btn-acao btn-avaliar"
                (click)="abrirModalAvaliacao(agendamento)"
                title="Avaliar servi√ßo">
                ‚≠ê Avaliar
              </button>
              
              <button 
                *ngIf="podeCancelar(agendamento)"
                class="btn-acao btn-cancelar"
                (click)="abrirModalCancelar(agendamento)"
                title="Cancelar agendamento">
                ‚ùå Cancelar
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Sem Agendamentos -->
  <div class="sem-agendamentos" *ngIf="!carregando && agendamentosFiltrados.length === 0">
    <div class="icone-vazio">üìÖ</div>
    <h3>Nenhum agendamento encontrado</h3>
    <p *ngIf="filtroStatus === 'todos'">Voc√™ ainda n√£o tem agendamentos</p>
    <p *ngIf="filtroStatus !== 'todos'">N√£o h√° agendamentos com status "{{ getStatusTexto(filtroStatus) }}"</p>
    <button class="btn btn-primary" (click)="novoAgendamento()">
      Agendar Agora
    </button>
  </div>
</div>

<!-- Modal de Avalia√ß√£o -->
<div class="modal-overlay" *ngIf="mostrarModalAvaliacao" (click)="fecharModalAvaliacao()">
  <div class="modal-conteudo" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚≠ê Avaliar Servi√ßo</h2>
      <button class="btn-fechar" (click)="fecharModalAvaliacao()">√ó</button>
    </div>
    
    <div class="modal-body" *ngIf="agendamentoParaAvaliar">
      <div class="avaliacao-info">
        <h3>{{ agendamentoParaAvaliar.servico_nome }}</h3>
        <p>Profissional: {{ agendamentoParaAvaliar.funcionario_nome }}</p>
        <p>{{ formatarData(agendamentoParaAvaliar.data_agendamento) }}</p>
      </div>

      <div class="avaliacao-estrelas">
        <p>Como voc√™ avalia o servi√ßo?</p>
        <div class="estrelas">
          <span 
            *ngFor="let i of [1,2,3,4,5]"
            class="estrela"
            [class.selecionada]="i <= notaAvaliacao"
            (click)="selecionarNota(i)">
            ‚òÖ
          </span>
        </div>
      </div>

      <div class="avaliacao-comentario">
        <label>Deixe seu coment√°rio (opcional)</label>
        <textarea 
          [(ngModel)]="comentarioAvaliacao"
          placeholder="Conte-nos sobre sua experi√™ncia..."
          rows="4"></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="fecharModalAvaliacao()">
        Cancelar
      </button>
      <button class="btn btn-primary" (click)="enviarAvaliacao()" [disabled]="notaAvaliacao === 0">
        Enviar Avalia√ß√£o
      </button>
    </div>
  </div>
</div>

<!-- Modal de Cancelamento -->
<div class="modal-overlay" *ngIf="mostrarModalCancelar" (click)="fecharModalCancelar()">
  <div class="modal-conteudo modal-pequeno" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚ö†Ô∏è Cancelar Agendamento</h2>
      <button class="btn-fechar" (click)="fecharModalCancelar()">√ó</button>
    </div>
    
    <div class="modal-body" *ngIf="agendamentoParaCancelar">
      <p>Tem certeza que deseja cancelar este agendamento?</p>
      <div class="confirmacao-info">
        <strong>{{ agendamentoParaCancelar.servico_nome }}</strong>
        <p>{{ formatarData(agendamentoParaCancelar.data_agendamento) }} √†s {{ agendamentoParaCancelar.hora_inicio.substring(0,5) }}</p>
        <p>Profissional: {{ agendamentoParaCancelar.funcionario_nome }}</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="fecharModalCancelar()">
        N√£o, manter
      </button>
      <button class="btn btn-danger" (click)="confirmarCancelamento()">
        Sim, cancelar
      </button>
    </div>
  </div>
</div>
