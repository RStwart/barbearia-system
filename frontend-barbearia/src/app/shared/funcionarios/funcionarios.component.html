<div class="funcionarios-container">
  <!-- Header -->
  <div class="header">
    <h1>üë• Gerenciar Funcion√°rios</h1>
    <button class="btn btn-primary" (click)="abrirModalNovo()">
      <span class="icon">‚ûï</span>
      Novo Funcion√°rio
    </button>
  </div>

  <!-- Mensagens -->
  <div class="mensagem sucesso" *ngIf="sucesso">
    ‚úÖ {{ sucesso }}
  </div>

  <div class="mensagem erro" *ngIf="erro && !mostrarModalForm && !mostrarModalExcluir">
    ‚ùå {{ erro }}
  </div>

  <!-- Filtros -->
  <div class="filtros-container">
    <div class="busca-box">
      <span class="icone-busca">üîç</span>
      <input 
        type="text" 
        [(ngModel)]="termoBusca" 
        (input)="aplicarFiltros(); paginaAtual = 1"
        placeholder="Buscar por nome, email ou telefone..."
        class="input-busca">
      <button class="btn-limpar" (click)="limparFiltros()" *ngIf="termoBusca">‚úñ</button>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="carregando && funcionarios.length === 0">
    <div class="spinner"></div>
    <p>Carregando funcion√°rios...</p>
  </div>

  <!-- Tabela -->
  <div class="table-container" *ngIf="!carregando || funcionarios.length > 0">
    <table class="funcionarios-table">
      <thead>
        <tr>
          <th>Funcion√°rio</th>
          <th>Email</th>
          <th>Telefone</th>
          <th>Status</th>
          <th>1¬∫ Acesso</th>
          <th>Cadastrado em</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let funcionario of funcionariosPaginados">
          <td>
            <div class="user-info">
              <div class="avatar">
                <img [src]="funcionario.foto_perfil" *ngIf="funcionario.foto_perfil" alt="Foto">
                <span *ngIf="!funcionario.foto_perfil">{{ getIniciais(funcionario.nome) }}</span>
              </div>
              <span class="nome">{{ funcionario.nome }}</span>
            </div>
          </td>
          <td>{{ funcionario.email }}</td>
          <td>{{ funcionario.telefone || '-' }}</td>
          <td>
            <button 
              class="status-badge"
              [class.ativo]="funcionario.ativo"
              [class.inativo]="!funcionario.ativo"
              (click)="alternarStatus(funcionario)">
              {{ funcionario.ativo ? 'Ativo' : 'Inativo' }}
            </button>
          </td>
          <td>
            <span class="badge" [class.sim]="funcionario.primeiro_acesso" [class.nao]="!funcionario.primeiro_acesso">
              {{ funcionario.primeiro_acesso ? 'Sim' : 'N√£o' }}
            </span>
          </td>
          <td>{{ formatarData(funcionario.criado_em!) }}</td>
          <td>
            <div class="acoes">
              <button class="btn-acao editar" (click)="abrirModalEditar(funcionario)" title="Editar">
                ‚úèÔ∏è
              </button>
              <button class="btn-acao resetar" (click)="resetarSenha(funcionario)" title="Resetar Senha">
                üîë
              </button>
              <button class="btn-acao excluir" (click)="confirmarExclusao(funcionario)" title="Excluir">
                üóëÔ∏è
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Sem resultados -->
    <div class="sem-resultados" *ngIf="funcionariosPaginados.length === 0">
      <span class="icone">üì≠</span>
      <h3>Nenhum funcion√°rio encontrado</h3>
      <p *ngIf="termoBusca">Tente ajustar os filtros de busca</p>
      <p *ngIf="!termoBusca">Clique em "Novo Funcion√°rio" para cadastrar</p>
    </div>
  </div>

  <!-- Pagina√ß√£o -->
  <div class="paginacao" *ngIf="totalPaginas > 1">
    <button 
      class="btn-pagina"
      [disabled]="paginaAtual === 1"
      (click)="irParaPagina(paginaAtual - 1)">
      ‚Äπ
    </button>

    <button 
      *ngFor="let pagina of paginasVisiveis"
      class="btn-pagina"
      [class.ativo]="pagina === paginaAtual"
      [disabled]="pagina === -1"
      (click)="pagina !== -1 && irParaPagina(pagina)">
      {{ pagina === -1 ? '...' : pagina }}
    </button>

    <button 
      class="btn-pagina"
      [disabled]="paginaAtual === totalPaginas"
      (click)="irParaPagina(paginaAtual + 1)">
      ‚Ä∫
    </button>
  </div>

  <!-- Informa√ß√µes -->
  <div class="info-paginacao" *ngIf="funcionariosFiltrados.length > 0">
    Mostrando {{ (paginaAtual - 1) * itensPorPagina + 1 }} - 
    {{ Math.min(paginaAtual * itensPorPagina, funcionariosFiltrados.length) }} 
    de {{ funcionariosFiltrados.length }} funcion√°rios
  </div>
</div>

<!-- Modal Formul√°rio -->
<div class="modal-overlay" *ngIf="mostrarModalForm" (click)="fecharModais()">
  <div class="modal-conteudo" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ editando ? '‚úèÔ∏è Editar Funcion√°rio' : '‚ûï Novo Funcion√°rio' }}</h2>
      <button class="btn-fechar" (click)="fecharModais()">√ó</button>
    </div>

    <div class="modal-body">
      <div class="mensagem erro" *ngIf="erro">
        ‚ùå {{ erro }}
      </div>

      <div class="form-grupo">
        <label>Nome Completo *</label>
        <input 
          type="text" 
          [(ngModel)]="formulario.nome"
          placeholder="Digite o nome completo"
          required>
      </div>

      <div class="form-grupo">
        <label>Email *</label>
        <input 
          type="email" 
          [(ngModel)]="formulario.email"
          placeholder="exemplo@email.com"
          required>
      </div>

      <div class="form-linha">
        <div class="form-grupo">
          <label>Telefone</label>
          <input 
            type="text" 
            [(ngModel)]="formulario.telefone"
            placeholder="(11) 99999-9999">
        </div>

        <div class="form-grupo" *ngIf="editando">
          <label>Status</label>
          <select [(ngModel)]="formulario.ativo">
            <option [value]="true">Ativo</option>
            <option [value]="false">Inativo</option>
          </select>
        </div>
      </div>

      <div class="form-grupo">
        <label>URL da Foto (opcional)</label>
        <input 
          type="text" 
          [(ngModel)]="formulario.foto_perfil"
          placeholder="https://exemplo.com/foto.jpg">
      </div>

      <div class="info-box" *ngIf="!editando">
        <strong>‚ÑπÔ∏è Informa√ß√£o:</strong>
        <p>O funcion√°rio receber√° a senha padr√£o: <strong>Funcionario123</strong></p>
        <p>Ele dever√° alterar a senha no primeiro acesso.</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="fecharModais()" [disabled]="carregando">
        Cancelar
      </button>
      <button class="btn btn-primary" (click)="salvarFuncionario()" [disabled]="carregando">
        {{ carregando ? 'Salvando...' : (editando ? 'Salvar Altera√ß√µes' : 'Cadastrar Funcion√°rio') }}
      </button>
    </div>
  </div>
</div>

<!-- Modal Confirma√ß√£o Exclus√£o -->
<div class="modal-overlay" *ngIf="mostrarModalExcluir" (click)="fecharModais()">
  <div class="modal-conteudo modal-pequeno" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚ö†Ô∏è Confirmar Exclus√£o</h2>
      <button class="btn-fechar" (click)="fecharModais()">√ó</button>
    </div>

    <div class="modal-body">
      <div class="mensagem erro" *ngIf="erro">
        ‚ùå {{ erro }}
      </div>

      <p>Tem certeza que deseja excluir o funcion√°rio:</p>
      <p class="nome-destaque">{{ funcionarioSelecionado?.nome }}</p>
      <p class="aviso">Esta a√ß√£o ir√° desativar o funcion√°rio no sistema.</p>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="fecharModais()" [disabled]="carregando">
        Cancelar
      </button>
      <button class="btn btn-danger" (click)="excluirFuncionario()" [disabled]="carregando">
        {{ carregando ? 'Excluindo...' : 'Confirmar Exclus√£o' }}
      </button>
    </div>
  </div>
</div>
