<div class="dashboard-container">
  <!-- HEADER -->
  <div class="header">
    <h1>ğŸ“Š Dashboard</h1>
    <p class="subtitle" *ngIf="!isFuncionario">VisÃ£o geral do seu negÃ³cio</p>
    <p class="subtitle" *ngIf="isFuncionario">HistÃ³rico dos seus atendimentos</p>
  </div>

  <!-- MENSAGEM -->
  <div *ngIf="mensagem" class="mensagem" [class.sucesso]="tipoMensagem === 'sucesso'" [class.erro]="tipoMensagem === 'erro'">
    {{ mensagem }}
  </div>

  <!-- LOADING ESTATÃSTICAS -->
  <div *ngIf="carregandoEstatisticas && !isFuncionario" class="loading">
    <div class="spinner"></div>
    <p>Carregando estatÃ­sticas...</p>
  </div>

  <!-- CARDS DE ESTATÃSTICAS (APENAS GERENTE) -->
  <div *ngIf="!carregandoEstatisticas && estatisticas && !isFuncionario" class="stats-grid">
    <!-- Card Dia -->
    <div class="stat-card card-blue">
      <div class="stat-icon">ğŸ“…</div>
      <div class="stat-info">
        <h3>Hoje</h3>
        <p class="stat-value">{{ formatarPreco(estatisticas.vendasDia.valor) }}</p>
        <p class="stat-label">{{ estatisticas.vendasDia.total }} vendas</p>
      </div>
    </div>

    <!-- Card Semana -->
    <div class="stat-card card-green">
      <div class="stat-icon">ğŸ“†</div>
      <div class="stat-info">
        <h3>Esta Semana</h3>
        <p class="stat-value">{{ formatarPreco(estatisticas.vendasSemana.valor) }}</p>
        <p class="stat-label">{{ estatisticas.vendasSemana.total }} vendas</p>
      </div>
    </div>

    <!-- Card MÃªs -->
    <div class="stat-card card-purple">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-info">
        <h3>Este MÃªs</h3>
        <p class="stat-value">{{ formatarPreco(estatisticas.vendasMes.valor) }}</p>
        <p class="stat-label">{{ estatisticas.vendasMes.total }} vendas</p>
      </div>
    </div>

    <!-- Card Ano -->
    <div class="stat-card card-orange">
      <div class="stat-icon">ğŸ“ˆ</div>
      <div class="stat-info">
        <h3>Este Ano</h3>
        <p class="stat-value">{{ formatarPreco(estatisticas.vendasAno.valor) }}</p>
        <p class="stat-label">{{ estatisticas.vendasAno.total}} vendas</p>
      </div>
    </div>
  </div>

  <!-- SERVIÃ‡OS MAIS VENDIDOS (APENAS GERENTE) -->
  <div *ngIf="!carregandoEstatisticas && estatisticas && !isFuncionario" class="ranking-grid">
    <!-- Top ServiÃ§os -->
    <div class="ranking-card">
      <h3>â­ ServiÃ§os Mais Vendidos (MÃªs)</h3>
      <div class="ranking-list">
        <div *ngFor="let servico of estatisticas.servicosMaisVendidos; let i = index" class="ranking-item">
          <span class="ranking-position">{{ i + 1 }}Âº</span>
          <span class="ranking-nome">{{ servico.servico_nome }}</span>
          <span class="ranking-quantidade">{{ servico.total_vendido }} vez(es)</span>
          <span class="ranking-valor">{{ formatarPreco(servico.valor_total) }}</span>
        </div>
        <div *ngIf="estatisticas.servicosMaisVendidos.length === 0" class="ranking-vazio">
          Nenhum serviÃ§o vendido este mÃªs
        </div>
      </div>
    </div>
  </div>

  <!-- FILTROS DE VENDAS -->
  <div class="filtros-section">
    <h2>ğŸ’° HistÃ³rico de Vendas</h2>
    
    <div class="filtros-container">
      <div class="filtro-grupo">
        <label>Tipo:</label>
        <select [(ngModel)]="filtroTipoVenda" (change)="aplicarFiltros()">
          <option value="TODOS">Todos</option>
          <option value="SERVICO">ServiÃ§os</option>
          <option value="PRODUTO">Produtos</option>
          <option value="MISTO">Misto</option>
        </select>
      </div>

      <div class="filtro-grupo">
        <label>PerÃ­odo:</label>
        <select [(ngModel)]="filtroPeriodo" (change)="aplicarFiltros()">
          <option value="TODOS">Todos</option>
          <option value="HOJE">Hoje</option>
          <option value="SEMANA">Ãšltima Semana</option>
          <option value="MES">Este MÃªs</option>
        </select>
      </div>

      <div class="filtro-grupo busca-grupo">
        <label>Buscar:</label>
        <input 
          type="text" 
          [(ngModel)]="termoBusca" 
          (input)="aplicarFiltros()"
          placeholder="Cliente ou funcionÃ¡rio..."
        />
      </div>

      <button class="btn-limpar-filtros" (click)="limparFiltros()">
        ğŸ—‘ï¸ Limpar
      </button>
    </div>
  </div>

  <!-- LOADING VENDAS -->
  <div *ngIf="carregandoVendas" class="loading">
    <div class="spinner"></div>
    <p>Carregando vendas...</p>
  </div>

  <!-- TABELA DE VENDAS -->
  <div *ngIf="!carregandoVendas" class="table-container">
    <table class="vendas-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Data/Hora</th>
          <th>Tipo</th>
          <th>Cliente</th>
          <th>FuncionÃ¡rio</th>
          <th>Valor</th>
          <th>Pagamento</th>
          <th>AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let venda of vendasPaginadas">
          <td>#{{ venda.id }}</td>
          <td>{{ formatarDataHora(venda.criado_em!) }}</td>
          <td>
            <span class="badge-tipo" [ngClass]="getTipoVendaClass(venda.tipo_venda)">
              {{ venda.tipo_venda }}
            </span>
          </td>
          <td>{{ venda.cliente_nome || 'N/A' }}</td>
          <td>{{ venda.funcionario_nome }}</td>
          <td class="valor">{{ formatarPreco(venda.valor_total) }}</td>
          <td>{{ venda.forma_pagamento }}</td>
          <td>
            <button 
              class="btn-acao btn-visualizar" 
              (click)="visualizarDetalhes(venda)"
              title="Ver Detalhes"
            >
              ï¿½ï¸
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="vendasFiltradas.length === 0" class="sem-resultados">
      <span class="icone">ğŸ”</span>
      <h3>Nenhuma venda encontrada</h3>
      <p>Tente ajustar os filtros</p>
    </div>
  </div>

  <!-- PAGINAÃ‡ÃƒO -->
  <div *ngIf="vendasFiltradas.length > 0" class="paginacao">
    <button 
      class="btn-pagina" 
      (click)="mudarPagina(paginaAtual - 1)"
      [disabled]="paginaAtual === 1"
    >
      â—€
    </button>
    
    <span class="pagina-info">
      PÃ¡gina {{ paginaAtual }} de {{ totalPaginas }} ({{ vendasFiltradas.length }} vendas)
    </span>
    
    <button 
      class="btn-pagina" 
      (click)="mudarPagina(paginaAtual + 1)"
      [disabled]="paginaAtual === totalPaginas"
    >
      â–¶
    </button>
  </div>
</div>

