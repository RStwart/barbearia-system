<!-- ===== HEADER DA SE√á√ÉO ===== -->
<div class="admin-estabelecimentos">
  <!-- Cards de Estat√≠sticas -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üè¢</div>
      <div class="stat-content">
        <h3>{{ stats.totalUnidades }}</h3>
        <p>Total de Unidades</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <h3>{{ stats.unidadesAtivas }}</h3>
        <p>Unidades Ativas</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">üÜï</div>
      <div class="stat-content">
        <h3>{{ stats.novasUnidades }}</h3>
        <p>Novas Unidades (30 dias)</p>
      </div>
    </div>
  </div>

  <!-- Se√ß√£o de Unidades -->
  <div class="unidades-section">
    <div class="section-header">
      <h2>Gerenciar Estabelecimentos</h2>
      <button class="btn btn-primary" (click)="novaUnidade()">
        ‚ûï Nova Unidade
      </button>
    </div>

    <!-- Filtros -->
    <div class="filtros-container">
      <div class="filtro-group">
        <label>Filtrar por Nome:</label>
        <input 
          type="text" 
          [(ngModel)]="filtros.nome" 
          (input)="aplicarFiltros()"
          placeholder="Digite o nome da unidade..."
          class="form-input">
      </div>
      <div class="filtro-group">
        <label>Filtrar por ID:</label>
        <input 
          type="text" 
          [(ngModel)]="filtros.id_unidade" 
          (input)="aplicarFiltros()"
          placeholder="Digite o ID da unidade..."
          class="form-input">
      </div>
      <div class="filtro-group">
        <label>Status Avalia√ß√£o:</label>
        <select 
          [(ngModel)]="filtros.status_avaliacao" 
          (change)="aplicarFiltros()"
          class="form-select">
          <option value="">Todos</option>
          <option value="aprovado">Aprovado</option>
          <option value="aguardando">Aguardando</option>
          <option value="negado">Negado</option>
        </select>
      </div>
      <div class="filtro-group">
        <button class="btn btn-secondary" (click)="limparFiltros()">
          üóëÔ∏è Limpar Filtros
        </button>
      </div>
    </div>

    <!-- Tabela de Unidades -->
    <div class="scroll-hint" *ngIf="!carregando && unidadesPaginadas.length > 0">
      üëâ Deslize horizontalmente para ver mais colunas
    </div>
    <div class="table-container">
      <table class="unidades-table" *ngIf="!carregando && unidadesPaginadas.length > 0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Unidade</th>
            <th>Respons√°vel</th>
            <th>CNPJ/CPF</th>
            <th>Telefone</th>
            <th>Cidade/Estado</th>
            <th>Status</th>
            <th>Pagamento</th>
            <th>Avalia√ß√£o</th>
            <th>Cadastro</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let unidade of unidadesPaginadas">
            <td>{{ unidade.id_unidade }}</td>
            
            <td>
              <div class="unidade-info-cell">
                <div class="unidade-avatar">
                  {{ unidade.nome.charAt(0).toUpperCase() }}
                </div>
                <div>
                  <div class="unidade-nome">{{ unidade.nome }}</div>
                  <div class="unidade-email" *ngIf="unidade.email">{{ unidade.email }}</div>
                </div>
              </div>
            </td>
            
            <td>{{ unidade.responsavel || '-' }}</td>
            
            <td>
              <div *ngIf="unidade.cnpj">
                <strong>CNPJ:</strong> {{ unidade.cnpj }}
              </div>
              <div *ngIf="unidade.cpf">
                <strong>CPF:</strong> {{ unidade.cpf }}
              </div>
              <span *ngIf="!unidade.cnpj && !unidade.cpf">-</span>
            </td>
            
            <td>{{ unidade.telefone || '-' }}</td>
            
            <td>
              <div *ngIf="unidade.cidade || unidade.estado">
                {{ unidade.cidade || '' }}{{ unidade.cidade && unidade.estado ? '/' : '' }}{{ unidade.estado || '' }}
              </div>
              <span *ngIf="!unidade.cidade && !unidade.estado">-</span>
            </td>
            
            <td>
              <button 
                class="status-toggle"
                [class.active]="unidade.ativo"
                [class.inactive]="!unidade.ativo"
                (click)="alternarStatus(unidade)">
                {{ unidade.ativo ? 'Ativo' : 'Inativo' }}
              </button>
            </td>
            
            <td>
              <button 
                class="status-pagamento"
                [ngClass]="getStatusPagamentoClass(unidade.status_pagamento)"
                (click)="alternarStatusPagamento(unidade)"
                title="Clique para alterar o status de pagamento">
                {{ getStatusPagamentoLabel(unidade.status_pagamento) }}
              </button>
            </td>
            
            <td>
              <button 
                class="status-avaliacao"
                [ngClass]="getStatusAvaliacaoClass(unidade.status_avaliacao)"
                (click)="alternarStatusAvaliacao(unidade)"
                title="Clique para alterar o status de avalia√ß√£o">
                {{ getStatusAvaliacaoLabel(unidade.status_avaliacao) }}
              </button>
            </td>
            
            <td>{{ unidade.data_cadastro | date:'dd/MM/yyyy HH:mm' }}</td>
            
            <td>
              <div class="action-buttons">
                <button 
                  class="btn-action btn-edit" 
                  (click)="editarUnidade(unidade)"
                  title="Editar">
                  ‚úèÔ∏è
                </button>
                <button 
                  class="btn-action btn-delete" 
                  (click)="excluirUnidade(unidade)"
                  title="Excluir">
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Loading -->
      <div class="table-loading" *ngIf="carregando">
        <div class="loading-spinner"></div>
        <p>Carregando unidades...</p>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!carregando && unidadesPaginadas.length === 0">
        <div class="empty-icon">üè¢</div>
        <h3>Nenhuma unidade encontrada</h3>
        <p>N√£o h√° unidades cadastradas no sistema ou que correspondam aos filtros aplicados.</p>
        <button class="btn btn-primary" (click)="novaUnidade()">
          ‚ûï Cadastrar primeira unidade
        </button>
      </div>
    </div>

    <!-- Pagina√ß√£o -->
    <div class="pagination-container" *ngIf="!carregando && unidadesFiltradas.length > 0">
      <div class="pagination-info">
        Mostrando {{ (paginaAtual - 1) * itensPorPagina + 1 }} - 
        {{ Math.min(paginaAtual * itensPorPagina, unidadesFiltradas.length) }} 
        de {{ unidadesFiltradas.length }} unidades
      </div>
      
      <div class="pagination">
        <button 
          class="btn-page" 
          (click)="irParaPagina(paginaAtual - 1)"
          [disabled]="paginaAtual === 1">
          ‚Üê Anterior
        </button>
        
        <button 
          *ngFor="let pagina of paginasArray" 
          class="btn-page"
          [class.active]="pagina === paginaAtual"
          (click)="irParaPagina(pagina)">
          {{ pagina }}
        </button>
        
        <button 
          class="btn-page" 
          (click)="irParaPagina(paginaAtual + 1)"
          [disabled]="paginaAtual === totalPaginas">
          Pr√≥xima ‚Üí
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ===== MODAL DE UNIDADE ===== -->
<div class="modal-overlay" *ngIf="mostrarModal" (click)="fecharModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ editando ? 'Editar Unidade' : 'Nova Unidade' }}</h3>
      <button class="modal-close" (click)="fecharModal()">‚úï</button>
    </div>
    
    <form class="modal-form" (ngSubmit)="salvarUnidade()">
      <!-- Dados B√°sicos -->
      <div class="form-section">
        <h4>Dados B√°sicos</h4>
        
        <div class="form-row">
          <div class="form-group required">
            <label>Nome da Unidade</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.nome" 
              name="nome"
              required
              placeholder="Nome da barbearia/sal√£o"
              class="form-input">
          </div>
          <div class="form-group">
            <label>Respons√°vel</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.responsavel" 
              name="responsavel"
              placeholder="Nome do respons√°vel"
              class="form-input">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>CNPJ</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.cnpj" 
              name="cnpj"
              (input)="formatarCNPJ($event)"
              placeholder="00.000.000/0000-00"
              maxlength="18"
              class="form-input">
          </div>
          <div class="form-group">
            <label>CPF (caso n√£o tenha CNPJ)</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.cpf" 
              name="cpf"
              (input)="formatarCPF($event)"
              placeholder="000.000.000-00"
              maxlength="14"
              class="form-input">
          </div>
        </div>
      </div>

      <!-- Contato -->
      <div class="form-section">
        <h4>Contato</h4>
        
        <div class="form-row">
          <div class="form-group">
            <label>Telefone</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.telefone" 
              name="telefone"
              (input)="formatarTelefone($event)"
              placeholder="(11) 99999-9999"
              maxlength="15"
              class="form-input">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input 
              type="email" 
              [(ngModel)]="unidadeForm.email" 
              name="email"
              placeholder="contato@unidade.com"
              class="form-input">
          </div>
        </div>
      </div>

      <!-- Endere√ßo -->
      <div class="form-section">
        <h4>Endere√ßo</h4>
        
        <div class="form-row">
          <div class="form-group">
            <label>CEP</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.cep" 
              name="cep"
              (input)="formatarCEP($event)"
              placeholder="00000-000"
              maxlength="9"
              class="form-input">
          </div>
          <div class="form-group">
            <label>Estado</label>
            <select 
              [(ngModel)]="unidadeForm.estado" 
              name="estado"
              class="form-select">
              <option value="">Selecione o estado</option>
              <option *ngFor="let estado of estados" [value]="estado.sigla">
                {{ estado.nome }} ({{ estado.sigla }})
              </option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Cidade</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.cidade" 
              name="cidade"
              placeholder="Nome da cidade"
              class="form-input">
          </div>
          <div class="form-group">
            <label>Bairro</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.bairro" 
              name="bairro"
              placeholder="Nome do bairro"
              class="form-input">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Endere√ßo</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.endereco" 
              name="endereco"
              placeholder="Rua, Avenida, etc."
              class="form-input">
          </div>
          <div class="form-group">
            <label>N√∫mero</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.numero" 
              name="numero"
              placeholder="123"
              class="form-input">
          </div>
        </div>

        <div class="form-row full-width">
          <div class="form-group">
            <label>Complemento</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.complemento" 
              name="complemento"
              placeholder="Apartamento, sala, andar, etc."
              class="form-input">
          </div>
        </div>
      </div>

      <!-- Funcionamento -->
      <div class="form-section">
        <h4>Funcionamento</h4>
        
        <div class="form-row">
          <div class="form-group">
            <label>Hor√°rio de Abertura</label>
            <input 
              type="time" 
              [(ngModel)]="unidadeForm.horario_abertura" 
              name="horario_abertura"
              class="form-input">
          </div>
          <div class="form-group">
            <label>Hor√°rio de Fechamento</label>
            <input 
              type="time" 
              [(ngModel)]="unidadeForm.horario_fechamento" 
              name="horario_fechamento"
              class="form-input">
          </div>
        </div>

        <div class="form-row full-width">
          <div class="form-group">
            <label>Descri√ß√£o do Funcionamento</label>
            <input 
              type="text" 
              [(ngModel)]="unidadeForm.horario_funcionamento" 
              name="horario_funcionamento"
              placeholder="Ex: Segunda a Sexta: 8h √†s 18h, S√°bado: 8h √†s 12h"
              class="form-input">
          </div>
        </div>
      </div>

      <!-- Localiza√ß√£o -->
      <div class="form-section">
        <h4>Localiza√ß√£o (Opcional)</h4>
        
        <div class="form-row">
          <div class="form-group">
            <label>Latitude</label>
            <input 
              type="number" 
              [(ngModel)]="unidadeForm.latitude" 
              name="latitude"
              step="0.00000001"
              placeholder="-23.5505199"
              class="form-input">
          </div>
          <div class="form-group">
            <label>Longitude</label>
            <input 
              type="number" 
              [(ngModel)]="unidadeForm.longitude" 
              name="longitude"
              step="0.00000001"
              placeholder="-46.6333094"
              class="form-input">
          </div>
        </div>
      </div>

      <!-- Status -->
      <div class="form-section">
        <div class="form-row full-width">
          <div class="form-group checkbox-group">
            <input 
              type="checkbox" 
              [(ngModel)]="unidadeForm.ativo" 
              name="ativo"
              id="unidade-ativa">
            <label for="unidade-ativa">Unidade Ativa</label>
          </div>
        </div>
      </div>

      <!-- Bot√µes do Modal -->
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="fecharModal()">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary">
          {{ editando ? 'Salvar Altera√ß√µes' : 'Criar Unidade' }}
        </button>
      </div>
    </form>
  </div>
</div>